<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Hospital Dashboard - LifeLink</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .blood { color: #dc3545; font-weight: bold; }
        .organ { color: #0d6efd; font-weight: bold; }
        .free { background: #d4edda; color: #155724; padding: 4px 8px; border-radius: 12px; font-size: 0.85em; }
        .paid { background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 12px; font-size: 0.85em; }
        .stats-card:hover { transform: translateY(-10px); }
        .blood-card { background: linear-gradient(135deg, #dc3545, #ff6b7a); color: white; }
        .organ-card { background: linear-gradient(135deg, #0d6efd, #4dabf7); color: white; }
        .pending-free { background: linear-gradient(135deg, #ffc107, #ffed4e); color: #856404; }
        .pending-paid { background: linear-gradient(135deg, #dc3545, #ff5252); color: white; }
    </style>
</head>
<body>
<div class="container py-5">
    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="display-4 fw-bold text-white">üè• <span th:text="${username}">Hospital</span></h1>
            <p class="text-white-50 lead">Complete Donor Management Dashboard</p>
        </div>
        <img th:src="@{${profilePicUrl}}" class="rounded-circle shadow" width="80" onerror="this.src='/uploads/blank_profile.jpg'"/>
    </div>

    <!-- STATS -->
    <div class="row mb-5 g-4">
        <div class="col-lg-3 col-md-6"><div class="card blood-card shadow-lg h-100"><div class="card-body text-center py-4"><i class="fas fa-tint fa-3x mb-3"></i><h5>ü©∏ Blood Donors</h5><p class="display-4" th:text="${totalBloodDonors}">0</p></div></div></div>
        <div class="col-lg-3 col-md-6"><div class="card organ-card shadow-lg h-100"><div class="card-body text-center py-4"><i class="fas fa-heart fa-3x mb-3"></i><h5>ü´Ä Organ Donors</h5><p class="display-4" th:text="${totalOrganDonors}">0</p></div></div></div>
        <div class="col-lg-3 col-md-6"><div class="card pending-free shadow-lg h-100"><div class="card-body text-center py-4"><i class="fas fa-clock fa-3x mb-3"></i><h5>‚è≥ Pending FREE</h5><p class="display-4" th:text="${pendingFreeDonors != null ? pendingFreeDonors.size() : 0}">0</p></div></div></div>
        <div class="col-lg-3 col-md-6"><div class="card pending-paid shadow-lg h-100"><div class="card-body text-center py-4"><i class="fas fa-credit-card fa-3x mb-3"></i><h5>üí≥ Pending PAID</h5><p class="display-4" th:text="${pendingPaidDonors != null ? pendingPaidDonors.size() : 0}">0</p></div></div></div>
    </div>

    <!-- 1. PENDING FREE -->
    <div class="card shadow-lg mb-4" th:if="${pendingFreeDonors != null and !pendingFreeDonors.isEmpty()}">
        <div class="card-header pending-free fw-bold">‚è≥ PENDING FREE DONORS (<span th:text="${pendingFreeDonors.size()}">0</span>)</div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-dark"><tr><th>Name</th><th>Phone</th><th>Type</th><th>Action</th></tr></thead>
                <tbody>
                <tr th:each="donor : ${pendingFreeDonors}">
                    <td><strong th:text="${donor.name}"></strong></td>
                    <td th:text="${donor.contact}"></td>
                    <td><span th:if="${donor.type == 'ORGAN'}" class="organ">ü´Ä ORGAN</span><span th:unless="${donor.type == 'ORGAN'}" class="blood">ü©∏ BLOOD</span></td>
                    <td>
                        <form th:action="@{/hospital/donor/approve(donorId=${donor.id}, donorType=${donor.type})}" method="post" class="d-inline me-2">
                            <button class="btn btn-success btn-sm">‚úÖ APPROVE</button>
                        </form>
                        <form th:action="@{/hospital/donor/remove(donorId=${donor.id}, donorType=${donor.type})}" method="post" class="d-inline">
                            <button class="btn btn-danger btn-sm" onclick="return confirm('Reject?')">‚ùå REJECT</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 2. PENDING PAID -->
    <div class="card shadow-lg mb-4" th:if="${pendingPaidDonors != null and !pendingPaidDonors.isEmpty()}">
        <div class="card-header pending-paid fw-bold">üí≥ PENDING PAID DONORS (<span th:text="${pendingPaidDonors.size()}">0</span>)</div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-dark"><tr><th>Name</th><th>Phone</th><th>Type</th><th>Action</th></tr></thead>
                <tbody>
                <tr th:each="donor : ${pendingPaidDonors}">
                    <td><strong th:text="${donor.name}"></strong></td>
                    <td th:text="${donor.contact}"></td>
                    <td><span th:if="${donor.type == 'ORGAN'}" class="organ">ü´Ä ORGAN</span><span th:unless="${donor.type == 'ORGAN'}" class="blood">ü©∏ BLOOD</span></td>
                    <td>
                        <form th:action="@{/hospital/donor/approve(donorId=${donor.id}, donorType=${donor.type})}" method="post" class="d-inline me-2">
                            <button class="btn btn-success btn-sm">‚úÖ APPROVE</button>
                        </form>
                        <form th:action="@{/hospital/donor/remove(donorId=${donor.id}, donorType=${donor.type})}" method="post" class="d-inline">
                            <button class="btn btn-danger btn-sm" onclick="return confirm('Reject?')">‚ùå REJECT</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 3. APPROVED BLOOD -->
    <div class="card shadow-lg mb-4" th:if="${approvedBloodDonors != null and !approvedBloodDonors.isEmpty()}">
        <div class="card-header blood-card text-white fw-bold">ü©∏ ALL APPROVED BLOOD DONORS (<span th:text="${approvedBloodDonors.size()}">0</span>)</div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-dark"><tr><th>Name</th><th>Phone</th><th>Blood Group</th><th>Free/Paid</th></tr></thead>
                <tbody>
                <tr th:each="donor : ${approvedBloodDonors}">
                    <td th:text="${donor.name}"></td>
                    <td th:text="${donor.contact}"></td>
                    <td><span class="badge bg-primary" th:text="${donor.bloodGroup}">A+</span></td>
                    <td><span th:classappend="${donor.donationType.name() == 'FREE' ? 'free' : 'paid'}" th:text="${donor.donationType.name()}">FREE</span></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 4. APPROVED ORGAN -->
    <div class="card shadow-lg" th:if="${approvedOrganDonors != null and !approvedOrganDonors.isEmpty()}">
        <div class="card-header organ-card text-white fw-bold">ü´Ä ALL APPROVED ORGAN DONORS (<span th:text="${approvedOrganDonors.size()}">0</span>)</div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-dark"><tr><th>Name</th><th>Phone</th><th>Organ</th><th>Free/Paid</th></tr></thead>
                <tbody>
                <tr th:each="donor : ${approvedOrganDonors}">
                    <td th:text="${donor.name}"></td>
                    <td th:text="${donor.contact}"></td>
                    <td><span class="badge bg-info" th:text="${donor.organType}">Kidney</span></td>
                    <td><span th:classappend="${donor.donationType.name() == 'FREE' ? 'free' : 'paid'}" th:text="${donor.donationType.name()}">FREE</span></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- EMPTY STATE -->
    <div th:if="${(pendingFreeDonors == null or pendingFreeDonors.isEmpty()) and (pendingPaidDonors == null or pendingPaidDonors.isEmpty()) and (approvedBloodDonors == null or approvedBloodDonors.isEmpty()) and (approvedOrganDonors == null or approvedOrganDonors.isEmpty())}"
         class="text-center py-5 text-white">
        <i class="fas fa-hospital fa-5x mb-4 opacity-50"></i>
        <h2 class="display-5">No Donors Yet</h2>
        <p class="lead">Waiting for donations assigned to this hospital</p>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>
